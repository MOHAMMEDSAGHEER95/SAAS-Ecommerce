{% extends 'dashboard/base.html' %}
{% block title %}
    <title>Dashboard: Orders</title>
    {% endblock %}
{% block body %}
<div class="container" style="overflow: auto;">
<div class="mx-auto" style="margin-top:40px">
    <form action="." method="get" autocomplete="off">
      <input type="text" name="number" placeholder="Search" {% if query%}value="{{query}}"{% endif %}>
    </form>
  </div>
  <div class="mx-auto" style="margin-top:40px">
    <form action="/dashboard/change-status/" method="post">
      <label for="change_status">Change Status</label>
      <select name="change_status" id="change_status">
        <option selected></option>
        <option value="packed">Packed</option>
        <option value="shipped">Shipped</option>
        <option value="delivered">Delivered</option>
      </select>
      <input type="hidden" name="orderid" id="orderid">
      <input type="submit" class="btn btn-primary" value="submit">
    </form>
  </div>
<div class="d-flex" style="width:100%">

  <table class="table">
    <thead>
      <tr>
        <th scope="row"><input type="checkbox" id="selectall"></th>
        <th scope="col">Order Number</th>
        <th scope="col">User Email</th>
        <th scope="col">Total</th>
        <th scope="col">Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {% for order in orders %}
      <tr>
        <th scope="row"><input type="checkbox" name="order" value="{{order.id}}"></th>
        <td>{{order.number}}</td>
        <td>{{order.user.email}}</td>
        <td>Â£ {{order.total_incl_tax}}</td>
        <td>{{order.status}}</td>
        <td><a href="{% url 'dashboard:dashboard_orders_edit' pk=order.id %}" type="button" class="btn btn-primary">Edit</a> </td>
      </tr>
    {% endfor %}
      <!-- Add more rows for each order -->
    </tbody>
  </table>
</div>
  <div class="pagination-container" style="text-align: center;">
<div class="pagination text-center">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if query%}&name={{query}}{% endif %}">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if query%}&name={{query}}{% endif %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if query%}&name={{query}}{% endif %}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if query%}&name={{query}}{% endif %}">last &raquo;</a>
        {% endif %}
    </span>
</div>
    </div>
  </div>



{% endblock %}

{% block script%}
<script>
$('#selectall').on("change", function (e) {
    $('input[name="order"]').prop("checked", $(this).prop("checked"));
    var checkedValues = [];
    $('input[name="order"]').each(function () {
        if ($(this).prop("checked")) {
            // Push the value to the array
            checkedValues.push($(this).val());
        }
    });
    $('#orderid').val(checkedValues.join(','));
});

  $('input[name="order"]').on("change",function (e) {
    var checkedValues = [];
    $('input[name="order"]').each(function () {
        if ($(this).prop("checked")) {
            // Push the value to the array
            checkedValues.push($(this).val());
        }
    });
    $('#orderid').val(checkedValues.join(','));
  })


</script>
{% endblock%}